# Руководство по восстановлению Debug-сессий

## Обзор

Данное руководство описывает процедуры восстановления после сбоев в режиме Debug, основанные на системе точного восстановления, описанной в техническом плане.

## Типы восстановления

### 1. Автоматическое восстановление

Система автоматически обнаруживает незавершенные Debug-сессии при запуске и предлагает варианты восстановления.

#### Файлы для проверки:
- `.action_trace.log` - журнал действий
- `.error_snapshot_*.json` - снимки ошибок
- `.debug_session.log` - детальные логи сессии

#### Алгоритм проверки:
1. Поиск записей `[START]` без соответствующих `[END]`
2. Анализ последнего успешного действия
3. Проверка наличия снимков ошибок

### 2. Ручное восстановление

#### Команды для диагностики:
```bash
# Проверка целостности логов
kilocode debug validate-logs

# Анализ последней сессии
kilocode debug analyze-session --session-id=<session_id>

# Просмотр доступных точек восстановления
kilocode debug list-recovery-points
```

#### Команды восстановления:
```bash
# Восстановление с последнего успешного действия
kilocode debug recover --from=last-success

# Восстановление с конкретной точки
kilocode debug recover --from=checkpoint --id=<checkpoint_id>

# Восстановление из снимка ошибки
kilocode debug recover --from=error-snapshot --file=<snapshot_file>
```

## Сценарии восстановления

### Сценарий 1: Сбой во время выполнения действия

**Признаки:**
- Запись `[START]` без `[END]` в `.action_trace.log`
- Отсутствие снимка ошибки

**Действия:**
1. Определить неудавшееся действие
2. Откатиться к предыдущему успешному действию
3. Повторить неудавшееся действие с дополнительным логированием

### Сценарий 2: Критическая ошибка с созданием снимка

**Признаки:**
- Наличие файла `.error_snapshot_*.json`
- Запись `[ERROR]` в журнале действий

**Действия:**
1. Загрузить снимок ошибки
2. Проанализировать контекст ошибки
3. Применить рекомендованные действия из снимка
4. Продолжить с безопасной точки

### Сценарий 3: Превышение лимита токенов

**Признаки:**
- Записи о достижении критических порогов
- Незавершенная передача контекста

**Действия:**
1. Загрузить последнее автосохранение
2. Применить агрессивную оптимизацию контекста
3. Продолжить с сжатым контекстом

## Профилактические меры

### Регулярные проверки:
- Мониторинг размера логов
- Проверка целостности журналов действий
- Очистка старых снимков ошибок

### Настройки для предотвращения сбоев:
```json
{
  "preventive_measures": {
    "max_log_size": "100MB",
    "auto_cleanup_days": 7,
    "checkpoint_frequency": "every_10_actions",
    "memory_monitoring": true
  }
}
```

## Устранение неполадок

### Поврежденные логи
```bash
# Восстановление поврежденных логов
kilocode debug repair-logs --auto

# Создание нового журнала действий
kilocode debug init-new-session
```

### Отсутствующие файлы восстановления
```bash
# Создание минимального контекста восстановления
kilocode debug create-minimal-context

# Экспорт текущего состояния
kilocode debug export-state --format=json
```

### Конфликты версий
```bash
# Миграция старых форматов
kilocode debug migrate --from-version=<old_version>

# Проверка совместимости
kilocode debug check-compatibility
```

## Контакты и поддержка

При возникновении проблем, не описанных в данном руководстве:
1. Сохраните все файлы логов и снимков
2. Создайте отчет об ошибке с полным контекстом
3. Обратитесь к документации по расширенному управлению токенами